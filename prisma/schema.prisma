generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = "mysql://drivesync:Kirajok123@mysql.nethely.hu:3306/drivesync"
}

// --- FELHASZNÁLÓK ---

model User {
  id                  Int      @id @default(autoincrement())
  username            String   @unique @db.VarChar(50)
  email               String   @unique @db.VarChar(50) // Fontos: Auth.js miatt egyedinek kezeljük
  password            String   @db.VarChar(5000)
  isDark              Boolean? @default(false) @map("isDark") // MySQL-ben tinyint(1)
  registerDate        DateTime @default(now()) @map("registerDate") @db.Timestamp(0)
  twoFactorAuthEnabled Boolean? @default(false) @map("twoFactorAuth_enabled")

  // Kapcsolatok
  cars          Car[]
  expenses      Expense[]
  transactions  Transaction[]

  @@map("users")
}

// --- AUTÓK ---

model Car {
  id             Int       @id @default(autoincrement())
  ownerId        Int       @map("owner_id")
  license        String?   @db.VarChar(50)
  brand          String?   @db.VarChar(50)
  type           String?   @db.VarChar(50)
  vintage        Int?
  engineType     String?   @map("engine_type") @db.VarChar(50)
  fuelType       String?   @map("fuel_type") @db.VarChar(20)
  km             Int?
  tireSize       String?   @map("tire_size") @db.VarChar(255)
  service        DateTime? @db.Date // Utolsó szerviz dátuma
  insurance      DateTime? @db.Date
  color          String?   @db.VarChar(20)
  notes          String?   @db.Text
  inspectionDate DateTime? @map("inspection_date") @db.Date
  archived       Boolean?  @default(false)
  oilType        String?   @map("oil_type") @db.VarChar(50)
  oilQuantity    String?   @map("oil_quantity") @db.VarChar(20)

  // Kapcsolatok
  owner            User              @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  services         Service[]
  upcomingServices UpcomingService[]

  @@index([ownerId], map: "owner_id")
  @@map("cars")
}

// --- SZERVIZEK ÉS TÖRTÉNET ---

model Service {
  id            Int      @id @default(autoincrement())
  carId         Int      @map("car_id")
  serviceTypeId Int?     @map("service_type_id")
  serviceDate   DateTime @map("service_date") @db.Date
  km            Int
  price         Int
  replacedParts String?  @map("replaced_parts") @db.VarChar(255)

  // Kapcsolatok
  car         Car          @relation(fields: [carId], references: [id], onDelete: Cascade)
  serviceType ServiceType? @relation(fields: [serviceTypeId], references: [id])

  @@index([carId], map: "car_id")
  @@index([serviceTypeId], map: "service_type_id")
  @@map("services")
}

model UpcomingService {
  id            Int       @id @default(autoincrement())
  carId         Int       @map("car_id")
  serviceDate   DateTime  @map("service_date") @db.Date
  location      String?   @db.VarChar(255)
  notes         String?   @db.Text
  reminder      Boolean?  @default(false)
  lastEmailSent DateTime? @map("last_email_sent") @db.Date
  archived      Boolean?  @default(false)

  // Kapcsolatok
  car Car @relation(fields: [carId], references: [id], onDelete: Cascade)

  @@index([carId], map: "car_id")
  @@map("upcoming_services")
}

// --- PÉNZÜGYEK ---

model Expense {
  id       Int      @id @default(autoincrement())
  what     String   @db.VarChar(250)
  price    Int
  datet    DateTime @db.Date
  category String   @db.VarChar(255)
  ownerId  Int      @map("owner_id")

  // Kapcsolatok
  owner User @relation(fields: [ownerId], references: [id], onDelete: Cascade)

  @@index([ownerId], map: "expense_id")
  @@map("expense")
}

model Transaction {
  id          Int             @id @default(autoincrement())
  type        TransactionType
  description String          @db.VarChar(250)
  amount      Int
  date        DateTime        @db.Date
  ownerId     Int             @map("owner_id")

  // Kapcsolatok
  owner User @relation(fields: [ownerId], references: [id], onDelete: Cascade)

  @@index([ownerId], map: "fk_owner_transaction")
  @@map("transactions")
}

enum TransactionType {
  INCOME
  EXPENSE
}

// --- TÖRZADATOK (LOOKUP TABLES) ---

model CarType {
  id    Int    @id @default(autoincrement())
  brand String @db.VarChar(100)
  type  String @db.VarChar(100)

  @@index([brand], map: "idx_brand")
  @@map("car_types")
}

model EngineType {
  id   Int    @id @default(autoincrement())
  name String @unique @db.VarChar(100)

  @@map("engine_types")
}

model ModelEngineType {
  id         Int    @id @default(autoincrement())
  brand      String @db.VarChar(100)
  type       String @db.VarChar(100)
  engineName String @map("engine_name") @db.VarChar(100)

  @@unique([brand, type, engineName], map: "brand")
  @@map("model_engine_types")
}

model OilQuantity {
  id   Int    @id @default(autoincrement())
  name String @unique @db.VarChar(20)

  @@map("oil_quantities")
}

model OilType {
  id   Int    @id @default(autoincrement())
  name String @unique @db.VarChar(50)

  @@map("oil_types")
}

model ServiceType {
  id       Int       @id @default(autoincrement())
  name     String    @db.VarChar(100)
  services Service[]

  @@map("service_types")
}

model TireSize {
  id   Int    @id @default(autoincrement())
  name String @unique @db.VarChar(50)

  @@map("tire_sizes")
}