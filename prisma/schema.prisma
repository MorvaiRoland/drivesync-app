generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// --- FELHASZNÁLÓK ---

model User {
  id                   Int           @id @default(autoincrement())
  username             String        @unique
  email                String        @unique
  password             String
  isDark               Boolean?      @default(false)
  registerDate         DateTime      @default(now())
  twoFactorAuthEnabled Boolean?      @default(false)

  cars                 Car[]
  expenses             Expense[]
  transactions         Transaction[]

  @@map("users")
}

// --- AUTÓK ---

model Car {
  id             Int       @id @default(autoincrement())
  ownerId        Int
  license        String?
  brand          String?
  type           String?
  vintage        Int?
  engineType     String?
  fuelType       String?
  km             Int?
  tireSize       String?
  service        DateTime? @db.Date
  insurance      DateTime? @db.Date
  color          String?
  notes          String?
  inspectionDate DateTime? @db.Date
  archived       Boolean?  @default(false)
  oilType        String?
  oilQuantity    String?

  owner            User              @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  services         Service[]
  upcomingServices UpcomingService[]

  @@map("cars")
}

// --- SZERVIZEK ÉS TÖRTÉNET ---

model Service {
  id            Int      @id @default(autoincrement())
  carId         Int
  serviceTypeId Int?
  serviceDate   DateTime @db.Date
  km            Int
  price         Int
  replacedParts String?

  car         Car          @relation(fields: [carId], references: [id], onDelete: Cascade)
  serviceType ServiceType? @relation(fields: [serviceTypeId], references: [id])

  @@map("services")
}

model UpcomingService {
  id            Int       @id @default(autoincrement())
  carId         Int
  serviceDate   DateTime  @db.Date
  location      String?
  notes         String?
  reminder      Boolean?  @default(false)
  lastEmailSent DateTime? @db.Date
  archived      Boolean?  @default(false)

  car Car @relation(fields: [carId], references: [id], onDelete: Cascade)

  @@map("upcoming_services")
}

// --- PÉNZÜGYEK ---

model Expense {
  id       Int      @id @default(autoincrement())
  what     String
  price    Int
  datet    DateTime @db.Date
  category String
  ownerId  Int

  owner User @relation(fields: [ownerId], references: [id], onDelete: Cascade)

  @@map("expense")
}

model Transaction {
  id          Int             @id @default(autoincrement())
  type        TransactionType
  description String
  amount      Int
  date        DateTime        @db.Date
  ownerId     Int

  owner User @relation(fields: [ownerId], references: [id], onDelete: Cascade)

  @@map("transactions")
}

enum TransactionType {
  INCOME
  EXPENSE
}

// --- TÖRZADATOK (Lookup Tables) ---

model CarType {
  id    Int    @id @default(autoincrement())
  brand String
  type  String

  @@map("car_types")
}

model EngineType {
  id   Int    @id @default(autoincrement())
  name String @unique

  @@map("engine_types")
}

model ModelEngineType {
  id         Int    @id @default(autoincrement())
  brand      String
  type       String
  engineName String

  @@unique([brand, type, engineName])
  @@map("model_engine_types")
}

model OilQuantity {
  id   Int    @id @default(autoincrement())
  name String @unique

  @@map("oil_quantities")
}

model OilType {
  id   Int    @id @default(autoincrement())
  name String @unique

  @@map("oil_types")
}

model ServiceType {
  id       Int       @id @default(autoincrement())
  name     String
  services Service[]

  @@map("service_types")
}

model TireSize {
  id   Int    @id @default(autoincrement())
  name String @unique

  @@map("tire_sizes")
}